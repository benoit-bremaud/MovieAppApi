# üìã MASTER TEST PLAN - MOVIE APP BACKEND

**Project**: MovieApp API (.NET 9.0)
**Date**: November 28, 2025
**Author**: [Your Name]
**Status**: DRAFT

---

## 1. üéØ PURPOSE & SCOPE

The objective is to validate the reliability, robustness, and specification compliance of the MovieApp Backend API.

### ‚úÖ In-Scope

- **API Controllers**: Verification of HTTP status codes (200, 404, 500) and JSON response formats.
- **Business Services**: Logic for TMDB data fetching and playlist management.
- **Error Handling**: Validation of the global exception handling middleware.
- **Data Access Layer**: CRUD operations against the database (using an in-memory provider).
- **Input Validation**: DTO validation (required fields, data types).

### ‚ùå Out-of-Scope

- User Interface (Frontend).
- Load/Performance Testing.
- Advanced Security Testing (Penetration Testing).

---

## 2. ‚öôÔ∏è TEST STRATEGY

This project follows the standard **Test Pyramid** model.

### 2.1. Unit Tests

- **Target**: Services, pure logic, DTOs.
- **Tools**: xUnit, Moq.
- **Approach**: Full isolation. Dependencies (Database, TMDB's HTTP Client) are mocked.
- **Example**: Verify that `TmdbService` throws a `TmdbApiException` when the remote API returns a 500 error.

### 2.2. Integration Tests

- **Target**: Repositories, Controllers.
- **Tools**: xUnit, SQLite (In-Memory).
- **Approach**: Test components with a "real" but temporary database to validate SQL queries generated by Entity Framework Core.
- **Example**: Create a playlist in the DB, retrieve it, update it, and assert that its state is correctly persisted.

---

## 3. üõ† TECHNICAL ENVIRONMENT & TOOLS

| Component | Technology | Purpose |
| :--- | :--- | :--- |
| **Test Framework** | xUnit | Test execution and assertion. |
| **Mocking Library** | Moq | Simulating dependencies (e.g., ILogger, HttpClient). |
| **Assertion Library** | FluentAssertions | Writing readable and expressive assertions. |
| **Test Database** | SQLite (In-Memory) | Volatile database for integration tests. |
| **Code Coverage** | Coverlet | Measuring the percentage of code covered by tests. |

---

## 4. üß™ TEST COVERAGE MATRIX (KEY TEST CASES)

The following critical scenarios will be implemented and validated:

| ID | Component | Scenario | Type | Priority |
|:---|:---|:---|:---:|:---:|
| **TC-01** | `ExceptionMiddleware` | Must return a 404 JSON object for a `MovieNotFoundException`. | Unit | üî• High |
| **TC-02** | `ExceptionMiddleware` | Must return a 400 JSON object for an `ArgumentException`. | Unit | Medium |
| **TC-03** | `TmdbService` | Must correctly map the TMDB JSON response to the `MovieModel`. | Unit | High |
| **TC-04** | `TmdbService` | Must handle network errors (e.g., timeout, DNS failure) gracefully. | Unit | High |
| **TC-05** | `PlaylistRepository` | `CreateAsync` must correctly add a new entity to the database. | Integration | High |
| **TC-06** | `PlaylistRepository` | `UpdateAsync` must modify the entity's name and `UpdatedAt` timestamp. | Integration | High |
| **TC-07** | `MoviesController` | `GetById` should return HTTP 200 OK with the movie object if found. | Unit | Medium |
| **TC-08** | `MoviesController` | `GetById` should return HTTP 404 Not Found if the service throws an exception. | Unit | Medium |
| **TC-09** | `EnvService` | Must load the API key from environment variables. | Unit | Low |

---

## 5. ‚úÖ ACCEPTANCE CRITERIA

The build is considered **stable and ready for deployment** if:

1. 100% of the tests defined above pass (GREEN).
2. Overall code coverage is above 70%.
3. No regressions are detected in existing features after a code change.
